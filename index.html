<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Play</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&family=Almarai:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff0000;
            --primary-dark: #cc0000;
            --secondary-color: #ff3333;
            --dark-color: #000000;
            --darker-color: #111111;
            --card-color: #1a1a1a;
            --light-color: #FFFFFF;
            --gray-color: #B3B3B3;
            --glow-animation: glow 2s infinite alternate;
            --star-color: rgba(255, 255, 255, 0.8);
            --star-size: 1px;
            --star-count: 500;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', 'Almarai', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--dark-color);
            color: var(--light-color);
            overflow-x: hidden;
            position: relative;
            padding-bottom: 70px;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background-color: var(--star-color);
            width: var(--star-size);
            height: var(--star-size);
            border-radius: 50%;
            animation: twinkle var(--duration, 5s) infinite ease-in-out;
            opacity: var(--opacity, 0.8);
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(255, 0, 0, 0.2); }
            100% { box-shadow: 0 0 20px rgba(255, 0, 0, 0.6); }
        }

        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            transition: all 0.3s ease;
        }

        .app-logo {
            color: var(--primary-color);
            font-size: 24px;
            font-weight: bold;
            text-decoration: none;
            animation: fadeIn 1s ease-out;
        }

        .search-icon {
            color: var(--light-color);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-icon:hover {
            color: var(--primary-color);
        }

        .main-content {
            margin-top: 70px;
            padding: 15px;
            animation: fadeIn 0.8s ease-out;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .welcome-section {
            margin-bottom: 30px;
            text-align: center;
        }

        .welcome-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--primary-color);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .welcome-subtitle {
            font-size: 16px;
            color: var(--gray-color);
        }

        .category-section {
            margin-bottom: 30px;
        }

        .category-title {
            font-size: 20px;
            margin-bottom: 15px;
            padding-right: 10px;
            display: flex;
            align-items: center;
            color: var(--light-color);
        }

        .category-title i {
            margin-left: 10px;
            color: var(--primary-color);
        }

        .movies-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 15px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) var(--dark-color);
        }

        .movies-container::-webkit-scrollbar {
            height: 6px;
        }

        .movies-container::-webkit-scrollbar-track {
            background: var(--dark-color);
        }

        .movies-container::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 6px;
        }

        .movie-card {
            position: relative;
            min-width: 150px;
            width: 150px;
            height: 225px;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        .movie-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }

        .movie-card.glow {
            animation: var(--glow-animation);
        }

        .movie-poster {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.5s ease;
        }

        .movie-title-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 8px;
            text-align: center;
        }

        .movie-title-text {
            font-size: 14px;
            color: var(--light-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Movie Detail Page */
        .movie-detail-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--dark-color);
            z-index: 200;
            display: none;
            overflow-y: auto;
            animation: fadeIn 0.5s ease-out;
        }

        .movie-backdrop {
            position: relative;
            width: 100%;
            height: 250px;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: flex-end;
        }

        .backdrop-overlay {
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, var(--dark-color), transparent);
            position: absolute;
            bottom: 0;
        }

        .back-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s;
        }

        .back-button:hover {
            background-color: var(--primary-color);
        }

        .movie-info-container {
            padding: 20px;
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
        }

        .movie-poster-container {
            display: flex;
            justify-content: center;
            margin-top: -100px;
            margin-bottom: 20px;
            z-index: 5;
            position: relative;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .movie-poster-large {
            width: 180px;
            height: 270px;
            border-radius: 12px;
            object-fit: cover;
            box-shadow: 0 8px 16px rgba(0,0,0,0.5);
            border: 3px solid var(--primary-color);
            transition: all 0.3s;
        }

        .movie-poster-large:hover {
            transform: scale(1.03);
            box-shadow: 0 12px 24px rgba(0,0,0,0.7);
        }

        .movie-info-content {
            background-color: var(--card-color);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .movie-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--light-color);
            font-family: 'Almarai', sans-serif;
        }

        .movie-rating {
            display: inline-block;
            background-color: var(--secondary-color);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .movie-rating i {
            margin-left: 5px;
            font-size: 12px;
        }

        .movie-description {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--gray-color);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .play-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .play-button::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }

        .play-button:hover::before {
            left: 100%;
        }

        .play-button i {
            margin-left: 10px;
            transform: translateX(-10px);
            transition: transform 0.3s;
        }

        .play-button:hover i {
            transform: translateX(0);
        }

        .favorite-button {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .favorite-button.active {
            color: var(--primary-color);
        }

        .favorite-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Seasons Page (for series) */
        .seasons-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--dark-color);
            z-index: 250;
            display: none;
            overflow-y: auto;
            padding-top: 70px;
            padding-bottom: 70px;
            animation: fadeIn 0.5s ease-out;
        }

        .seasons-container {
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .season-card {
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .season-title {
            font-size: 20px;
            color: var(--light-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .episodes-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 15px;
        }

        .episode-card {
            background-color: var(--darker-color);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
            min-width: 160px;
            flex-shrink: 0;
        }

        .episode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }

        .episode-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .episode-info {
            padding: 10px;
        }

        .episode-number {
            font-size: 12px;
            color: var(--gray-color);
            margin-bottom: 5px;
        }

        .episode-name {
            font-size: 14px;
            color: var(--light-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Video Player Page - New Design */
        .video-player-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: black;
            z-index: 300;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .video-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .video-player {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Top Controls */
        .top-controls {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .video-player-page:hover .top-controls,
        .top-controls.active {
            opacity: 1;
        }

        .video-title-container {
            display: flex;
            align-items: center;
            max-width: 70%;
        }

        .video-title {
            font-size: 16px;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .close-player-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            margin-right: 15px;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-player-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .settings-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .settings-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Center Play Button */
        .center-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            transition: all 0.3s;
            cursor: pointer;
        }

        .center-play-btn.show {
            opacity: 1;
        }

        .center-play-btn i {
            color: white;
            font-size: 30px;
            transition: transform 0.2s;
        }

        .center-play-btn:active i {
            transform: scale(1.2);
        }

        /* Bottom Controls */
        .bottom-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .video-player-page:hover .bottom-controls,
        .bottom-controls.active {
            opacity: 1;
        }

        /* Improved Progress Bar */
        .progress-container {
            width: 100%;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            margin-bottom: 15px;
            cursor: pointer;
            position: relative;
            transition: height 0.2s;
        }

        .progress-container:hover {
            height: 10px;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
            width: 0%;
            position: relative;
            transition: width 0.1s;
        }

        .progress-handle {
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background-color: var(--primary-color);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s, transform 0.2s;
            pointer-events: none;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .progress-container:hover .progress-handle {
            opacity: 1;
            transform: translateY(-50%) scale(1.2);
        }

        /* Buffered Progress */
        .buffered-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            width: 0%;
        }

        /* Time Display */
        .time-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .current-time, .total-time {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Control Buttons */
        .control-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .play-pause-btn {
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Settings Menu */
        .settings-menu {
            position: absolute;
            bottom: 80px;
            right: 15px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            padding: 10px 0;
            z-index: 20;
            display: none;
            min-width: 150px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .settings-menu.show {
            display: block;
        }

        .settings-option {
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: right;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-option:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .settings-option.active {
            color: var(--primary-color);
        }

        /* Quality Menu */
        .quality-menu {
            position: absolute;
            bottom: 80px;
            right: 15px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            padding: 10px 0;
            z-index: 20;
            display: none;
            min-width: 150px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .quality-menu.show {
            display: block;
        }

        /* Speed Menu */
        .speed-menu {
            position: absolute;
            bottom: 80px;
            right: 15px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            padding: 10px 0;
            z-index: 20;
            display: none;
            min-width: 150px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .speed-menu.show {
            display: block;
        }

        /* Preview Thumbnail */
        .preview-thumbnail {
            position: absolute;
            bottom: 40px;
            left: 0;
            width: 120px;
            height: 70px;
            background-size: cover;
            background-position: center;
            border-radius: 4px;
            display: none;
            pointer-events: none;
            z-index: 15;
            border: 2px solid white;
        }

        .preview-time {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        /* Search Page */
        .search-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--dark-color);
            z-index: 400;
            display: none;
            flex-direction: column;
            padding-top: 70px;
            animation: fadeIn 0.3s ease-out;
        }

        .search-header {
            padding: 15px;
            display: flex;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.9);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10;
        }

        .search-input-container {
            flex: 1;
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 8px 15px;
        }

        .search-input {
            flex: 1;
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            margin-right: 10px;
        }

        .search-input:focus {
            outline: none;
        }

        .search-icon-input {
            color: var(--gray-color);
            font-size: 16px;
        }

        .close-search {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            margin-right: 10px;
        }

        .search-results {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            margin-top: 60px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .search-placeholder {
            text-align: center;
            margin-top: 50px;
            color: var(--gray-color);
            font-size: 18px;
            grid-column: 1 / -1;
        }

        .no-results {
            text-align: center;
            margin-top: 50px;
            color: var(--gray-color);
            grid-column: 1 / -1;
        }

        /* Favorites Page */
        .favorites-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--dark-color);
            z-index: 500;
            display: none;
            flex-direction: column;
            padding-top: 70px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease-out;
        }

        .favorites-header {
            padding: 15px;
            font-size: 20px;
            color: var(--primary-color);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            position: relative;
        }

        .favorites-back-button {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            margin-left: 10px;
        }

        .favorites-header i {
            margin-left: 10px;
        }

        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Bottom Navigation - Always visible */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 100;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-button {
            background: none;
            border: none;
            color: var(--gray-color);
            font-size: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .nav-button i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .nav-button.active {
            color: var(--primary-color);
            background-color: rgba(255, 0, 0, 0.1);
        }

        .nav-button:hover {
            color: var(--light-color);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Responsive Styles */
        @media (min-width: 768px) {
            .welcome-title {
                font-size: 28px;
            }
            
            .welcome-subtitle {
                font-size: 18px;
            }
            
            .category-title {
                font-size: 22px;
            }
            
            .movie-backdrop {
                height: 350px;
            }
            
            .movie-poster-large {
                width: 200px;
                height: 300px;
            }
            
            .movie-card {
                min-width: 180px;
                width: 180px;
                height: 270px;
            }
            
            .search-results {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 20px;
            }
            
            .favorites-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 20px;
            }
        }

        @media (min-width: 1024px) {
            .movie-card {
                min-width: 200px;
                width: 200px;
                height: 300px;
            }
            
            .search-results {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .favorites-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        @media (max-width: 767px) and (orientation: landscape) {
            .video-player {
                width: 100%;
                height: auto;
                max-height: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Starry Background -->
    <div class="stars" id="stars"></div>
    
    <!-- Main Page -->
    <header class="app-header">
        <a href="#" class="app-logo" onclick="showMainPage()">Movie Play</a>
        <i class="fas fa-search search-icon" onclick="showSearchPage()"></i>
    </header>
    
    <div class="main-content" id="main-page">
        <section class="welcome-section">
            <h1 class="welcome-title">مرحباً بك في Movie Play</h1>
            <p class="welcome-subtitle">استمتع بأحدث الأفلام والمسلسلات</p>
        </section>
        
        <section class="category-section">
            <h2 class="category-title"><i class="fas fa-film"></i> الأفلام العربية</h2>
            <div class="movies-container" id="arabic-movies"></div>
        </section>
        
        <section class="category-section">
            <h2 class="category-title"><i class="fas fa-film"></i> الأفلام الأجنبية</h2>
            <div class="movies-container" id="english-movies"></div>
        </section>
        
        <section class="category-section">
            <h2 class="category-title"><i class="fas fa-film"></i> أفلام الأنمي</h2>
            <div class="movies-container" id="anime-movies"></div>
        </section>
        
        <section class="category-section">
            <h2 class="category-title"><i class="fas fa-film"></i> أفلام كورية</h2>
            <div class="movies-container" id="korean-movies"></div>
        </section>
        
        <section class="category-section">
            <h2 class="category-title"><i class="fas fa-tv"></i> مسلسلات عربية</h2>
            <div class="movies-container" id="arabic-series"></div>
        </section>
        
        <section class="category-section">
            <h2 class="category-title"><i class="fas fa-tv"></i> مسلسلات أنمي</h2>
            <div class="movies-container" id="anime-series"></div>
        </section>
        
        <section class="category-section">
            <h2 class="category-title"><i class="fas fa-tv"></i> مسلسلات كورية</h2>
            <div class="movies-container" id="korean-series"></div>
        </section>
    </div>
    
    <!-- Movie Detail Page -->
    <div class="movie-detail-page" id="movie-detail-page">
        <div class="movie-backdrop" id="movie-backdrop">
            <div class="backdrop-overlay"></div>
            <button class="back-button" onclick="showMainPage()">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>
        
        <div class="movie-info-container">
            <div class="movie-poster-container">
                <img src="" alt="" class="movie-poster-large" id="detail-movie-poster">
            </div>
            
            <div class="movie-info-content">
                <h1 class="movie-title" id="detail-movie-title"></h1>
                <div class="movie-rating" id="detail-movie-rating">
                    <i class="fas fa-star"></i>
                    <span id="rating-value"></span>
                </div>
                <p class="movie-description" id="detail-movie-description"></p>
                
                <div class="action-buttons">
                    <button class="play-button" onclick="showVideoPlayer()">
                        <span>تشغيل الفيلم</span>
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="favorite-button" id="favorite-btn">
                        <i class="fas fa-heart"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Seasons Page (for series) -->
    <div class="seasons-page" id="seasons-page">
        <button class="back-button" onclick="showMainPage()">
            <i class="fas fa-arrow-left"></i>
        </button>
        
        <div class="seasons-container" id="seasons-container">
            <!-- Seasons will be loaded here -->
        </div>
    </div>
    
    <!-- Video Player Page - New Design -->
    <div class="video-player-page" id="video-player-page">
        <div class="video-container">
            <video class="video-player" id="video-player"></video>
            
            <!-- Top Controls -->
            <div class="top-controls">
                <div class="video-title-container">
                    <button class="close-player-btn" onclick="backFromPlayer()">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="video-title" id="player-movie-title"></div>
                </div>
                <button class="settings-btn" id="settings-btn">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
            
            <!-- Center Play Button -->
            <div class="center-play-btn" id="center-play-btn">
                <i class="fas fa-play" id="center-play-icon"></i>
            </div>
            
            <!-- Bottom Controls -->
            <div class="bottom-controls">
                <!-- Progress Bar -->
                <div class="progress-container" id="progress-container">
                    <div class="buffered-bar" id="buffered-bar"></div>
                    <div class="progress-bar" id="progress-bar">
                        <div class="progress-handle"></div>
                    </div>
                </div>
                
                <!-- Preview Thumbnail -->
                <div class="preview-thumbnail" id="preview-thumbnail">
                    <div class="preview-time" id="preview-time">00:00</div>
                </div>
                
                <!-- Time Display -->
                <div class="time-display">
                    <span class="current-time" id="current-time">00:00</span>
                    <span class="total-time" id="total-time">00:00</span>
                </div>
                
                <!-- Control Buttons -->
                <div class="control-buttons">
                    <button class="control-btn" id="mute-btn">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <button class="control-btn" onclick="skipBackward()">
                        <i class="fas fa-backward"></i>
                    </button>
                    <button class="control-btn play-pause-btn" id="play-pause-btn">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn" onclick="skipForward()">
                        <i class="fas fa-forward"></i>
                    </button>
                    <button class="control-btn" id="fullscreen-btn">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
            
            <!-- Settings Menu -->
            <div class="settings-menu" id="settings-menu">
                <div class="settings-option" onclick="showQualityMenu()">
                    <span>جودة الفيديو</span>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="settings-option" onclick="showSpeedMenu()">
                    <span>سرعة التشغيل</span>
                    <i class="fas fa-chevron-left"></i>
                </div>
            </div>
            
            <!-- Quality Menu -->
            <div class="quality-menu" id="quality-menu">
                <div class="settings-option" onclick="changeQuality('auto')">
                    <span>تلقائي</span>
                </div>
                <div class="settings-option" onclick="changeQuality('144')">
                    <span>144p</span>
                </div>
                <div class="settings-option" onclick="changeQuality('360')">
                    <span>360p</span>
                </div>
                <div class="settings-option" onclick="changeQuality('720')">
                    <span>720p</span>
                </div>
                <div class="settings-option" onclick="changeQuality('1080')">
                    <span>1080p</span>
                </div>
            </div>
            
            <!-- Speed Menu -->
            <div class="speed-menu" id="speed-menu">
                <div class="settings-option" onclick="changeSpeed(0.5)">
                    <span>0.5x</span>
                </div>
                <div class="settings-option" onclick="changeSpeed(0.75)">
                    <span>0.75x</span>
                </div>
                <div class="settings-option active" onclick="changeSpeed(1)">
                    <span>1x</span>
                </div>
                <div class="settings-option" onclick="changeSpeed(1.5)">
                    <span>1.5x</span>
                </div>
                <div class="settings-option" onclick="changeSpeed(2)">
                    <span>2x</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Search Page -->
    <div class="search-page" id="search-page">
        <div class="search-header">
            <button class="close-search" onclick="hideSearchPage()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="search-input-container">
                <i class="fas fa-search search-icon-input"></i>
                <input type="text" class="search-input" id="search-input" placeholder="ابحث عن أفلام أو مسلسلات...">
            </div>
        </div>
        
        <div class="search-results" id="search-results">
            <div class="search-placeholder" id="search-placeholder">
                <i class="fas fa-search" style="font-size: 40px; margin-bottom: 15px;"></i>
                <p>ابحث عن الأفلام والمسلسلات المفضلة لديك</p>
            </div>
        </div>
    </div>
    
    <!-- Favorites Page -->
    <div class="favorites-page" id="favorites-page">
        <div class="favorites-header">
            <button class="favorites-back-button" onclick="showMainPage()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <i class="fas fa-heart"></i>
            <span>أفلامي المفضلة</span>
        </div>
        
        <div class="favorites-grid" id="favorites-grid">
            <!-- Favorites will be loaded here -->
        </div>
    </div>
    
    <!-- Bottom Navigation - Always visible -->
    <nav class="bottom-nav">
        <button class="nav-button active" onclick="showMainPage()">
            <i class="fas fa-home"></i>
            <span>الرئيسية</span>
        </button>
        <button class="nav-button" onclick="showSearchPage()">
            <i class="fas fa-search"></i>
            <span>بحث</span>
        </button>
        <button class="nav-button" onclick="showFavoritesPage()">
            <i class="fas fa-heart"></i>
            <span>المفضلة</span>
        </button>
    </nav>
    
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loading-spinner">
        <div class="spinner"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBmPMRk4pvowUnqQb3fCSTZqLRNiU6-ouo",
            authDomain: "marvel1-654dd.firebaseapp.com",
            databaseURL: "https://marvel1-654dd-default-rtdb.firebaseio.com",
            projectId: "marvel1-654dd",
            storageBucket: "marvel1-654dd.appspot.com",
            messagingSenderId: "189921979866",
            appId: "1:189921979866:android:95f48de58a69756be924e3"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Current movie/series data
        let currentMovie = {
            type: '', // 'movie' or 'series'
            category: '',
            id: '',
            name: '',
            desc: '',
            image: '',
            url: '',
            qualityUrls: {}, // Object to store different quality URLs
            rating: 0,
            seasons: null, // For series only
            currentTime: 0 // To save playback position
        };
        
        // App state
        let favorites = JSON.parse(localStorage.getItem('favorites')) || {};
        let isFullscreen = false;
        let currentSpeed = 1;
        let currentQuality = 'auto';
        let isPlaying = false;
        let isDraggingProgress = false;
        let controlsTimeout;
        let lastTapTime = 0;
        let isMuted = false;
        let searchTimeout;
        
        // DOM elements
        const mainPage = document.getElementById('main-page');
        const movieDetailPage = document.getElementById('movie-detail-page');
        const seasonsPage = document.getElementById('seasons-page');
        const videoPlayerPage = document.getElementById('video-player-page');
        const searchPage = document.getElementById('search-page');
        const favoritesPage = document.getElementById('favorites-page');
        const loadingSpinner = document.getElementById('loading-spinner');
        const starsContainer = document.getElementById('stars');
        const videoPlayer = document.getElementById('video-player');
        const centerPlayBtn = document.getElementById('center-play-btn');
        const centerPlayIcon = document.getElementById('center-play-icon');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const muteBtn = document.getElementById('mute-btn');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const bufferedBar = document.getElementById('buffered-bar');
        const previewThumbnail = document.getElementById('preview-thumbnail');
        const previewTime = document.getElementById('preview-time');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsMenu = document.getElementById('settings-menu');
        const qualityMenu = document.getElementById('quality-menu');
        const speedMenu = document.getElementById('speed-menu');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        const searchPlaceholder = document.getElementById('search-placeholder');
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            createStars();
            initVideoPlayer();
            loadAllContent();
            setupGlowEffect();
            loadFavorites();
            initSearch();
            
            // Handle back button on mobile devices
            window.onpopstate = function(event) {
                if (videoPlayerPage.style.display === 'block') {
                    backFromPlayer();
                } else if (movieDetailPage.style.display === 'block' || seasonsPage.style.display === 'block') {
                    showMainPage();
                } else if (searchPage.style.display === 'block' || favoritesPage.style.display === 'block') {
                    showMainPage();
                }
            };
        });
        
        // Create starry background
        function createStars() {
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.opacity = Math.random();
                star.style.setProperty('--duration', `${5 + Math.random() * 10}s`);
                starsContainer.appendChild(star);
            }
        }
        
        // Initialize video player
        function initVideoPlayer() {
            // Play/Pause functionality
            playPauseBtn.addEventListener('click', togglePlayPause);
            centerPlayBtn.addEventListener('click', togglePlayPause);
            
            // Mute button
            muteBtn.addEventListener('click', toggleMute);
            
            // Video click handlers
            videoPlayer.addEventListener('click', handleVideoClick);
            
            // Time display update
            videoPlayer.addEventListener('timeupdate', updateTimeDisplay);
            
            // Handle video end
            videoPlayer.addEventListener('ended', () => {
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                centerPlayIcon.className = 'fas fa-play';
                isPlaying = false;
                centerPlayBtn.classList.add('show');
            });
            
            // Handle fullscreen change
            document.addEventListener('fullscreenchange', () => {
                isFullscreen = !!document.fullscreenElement;
                fullscreenBtn.innerHTML = isFullscreen ? '<i class="fas fa-compress"></i>' : '<i class="fas fa-expand"></i>';
            });
            
            // Fullscreen button
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            
            // Settings button
            settingsBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                hideAllMenus();
                settingsMenu.classList.toggle('show');
                resetControlsTimer();
            });
            
            // Hide menus when clicking outside
            document.addEventListener('click', (e) => {
                if (!settingsBtn.contains(e.target) && !settingsMenu.contains(e.target)) {
                    settingsMenu.classList.remove('show');
                }
                if (!qualityMenu.contains(e.target)) {
                    qualityMenu.classList.remove('show');
                }
                if (!speedMenu.contains(e.target)) {
                    speedMenu.classList.remove('show');
                }
            });
            
            // Initialize video player events
            videoPlayer.addEventListener('play', () => {
                isPlaying = true;
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                centerPlayIcon.className = 'fas fa-pause';
                centerPlayBtn.classList.remove('show');
            });
            
            videoPlayer.addEventListener('pause', () => {
                isPlaying = false;
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                centerPlayIcon.className = 'fas fa-play';
                centerPlayBtn.classList.add('show');
            });
            
            // Initialize progress bar
            initProgressBar();
            
            // Hide controls when mouse is not moving
            videoPlayerPage.addEventListener('mousemove', () => {
                resetControlsTimer();
            });
            
            // Save current time when leaving player
            videoPlayer.addEventListener('timeupdate', () => {
                currentMovie.currentTime = videoPlayer.currentTime;
            });
            
            // Update buffered progress
            videoPlayer.addEventListener('progress', updateBufferedProgress);
        }
        
        // Initialize progress bar (left to right)
        function initProgressBar() {
            let isDragging = false;
            
            // Mouse/touch events for progress bar
            progressContainer.addEventListener('mousedown', startDrag);
            progressContainer.addEventListener('touchstart', startDrag);
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag);
            
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
            
            // Hover preview
            progressContainer.addEventListener('mousemove', showHoverPreview);
            progressContainer.addEventListener('mouseleave', hideHoverPreview);
            
            function startDrag(e) {
                isDragging = true;
                updateProgress(e);
                e.preventDefault();
            }
            
            function drag(e) {
                if (isDragging) {
                    updateProgress(e);
                    e.preventDefault();
                }
            }
            
            function endDrag() {
                if (isDragging) {
                    isDragging = false;
                    hideHoverPreview();
                    
                    // Update video time after dragging ends
                    if (videoPlayer.readyState > 0) {
                        videoPlayer.currentTime = (parseFloat(progressBar.style.width) / 100) * videoPlayer.duration;
                    }
                }
            }
            
            function updateProgress(e) {
                const rect = progressContainer.getBoundingClientRect();
                let pos = 0;
                
                if (e.type.includes('touch')) {
                    pos = (e.touches[0].clientX - rect.left) / rect.width;
                } else {
                    pos = (e.clientX - rect.left) / rect.width;
                }
                
                pos = Math.max(0, Math.min(1, pos));
                progressBar.style.width = `${pos * 100}%`;
                
                // Update time display during drag
                if (videoPlayer.readyState > 0) {
                    const newTime = pos * videoPlayer.duration;
                    document.getElementById('current-time').textContent = formatTime(newTime);
                }
            }
            
            function showHoverPreview(e) {
                if (isDragging) return;
                
                const rect = progressContainer.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                const hoverTime = pos * videoPlayer.duration;
                
                // Position preview thumbnail
                previewThumbnail.style.left = `${pos * 100}%`;
                previewThumbnail.style.display = 'block';
                previewTime.textContent = formatTime(hoverTime);
                
                // In a real app, you would show the actual frame thumbnail here
                // For demo, we'll just show a placeholder
                previewThumbnail.style.backgroundImage = `url('${currentMovie.image}')`;
            }
            
            function hideHoverPreview() {
                previewThumbnail.style.display = 'none';
            }
        }
        
        // Update buffered progress
        function updateBufferedProgress() {
            if (videoPlayer.buffered.length > 0) {
                const bufferedEnd = videoPlayer.buffered.end(videoPlayer.buffered.length - 1);
                const duration = videoPlayer.duration;
                if (duration > 0) {
                    const bufferedPercent = (bufferedEnd / duration) * 100;
                    bufferedBar.style.width = `${bufferedPercent}%`;
                }
            }
        }
        
        // Load all content from Firebase
        function loadAllContent() {
            showLoading();
            
            // Load Arabic Movies
            database.ref('ar').once('value').then(snapshot => {
                const movies = snapshot.val();
                const arabicMovies = document.getElementById('arabic-movies');
                arabicMovies.innerHTML = '';
                
                for (const key in movies) {
                    if (movies.hasOwnProperty(key)) {
                        const movie = movies[key];
                        arabicMovies.appendChild(createMovieCard(movie, 'ar', key, 'movie'));
                    }
                }
            });
            
            // Load English Movies
            database.ref('en').once('value').then(snapshot => {
                const movies = snapshot.val();
                const englishMovies = document.getElementById('english-movies');
                englishMovies.innerHTML = '';
                
                for (const key in movies) {
                    if (movies.hasOwnProperty(key)) {
                        const movie = movies[key];
                        englishMovies.appendChild(createMovieCard(movie, 'en', key, 'movie'));
                    }
                }
            });
            
            // Load Anime Movies
            database.ref('ani').once('value').then(snapshot => {
                const movies = snapshot.val();
                const animeMovies = document.getElementById('anime-movies');
                animeMovies.innerHTML = '';
                
                for (const key in movies) {
                    if (movies.hasOwnProperty(key)) {
                        const movie = movies[key];
                        animeMovies.appendChild(createMovieCard(movie, 'ani', key, 'movie'));
                    }
                }
            });
            
            // Load Korean Movies
            database.ref('kr').once('value').then(snapshot => {
                const movies = snapshot.val();
                const koreanMovies = document.getElementById('korean-movies');
                koreanMovies.innerHTML = '';
                
                for (const key in movies) {
                    if (movies.hasOwnProperty(key)) {
                        const movie = movies[key];
                        koreanMovies.appendChild(createMovieCard(movie, 'kr', key, 'movie'));
                    }
                }
            });
            
            // Load Arabic Series
            database.ref('arSerious').once('value').then(snapshot => {
                const series = snapshot.val();
                const arabicSeries = document.getElementById('arabic-series');
                arabicSeries.innerHTML = '';
                
                for (const seasonKey in series) {
                    if (series.hasOwnProperty(seasonKey)) {
                        const season = series[seasonKey];
                        for (const episodeKey in season) {
                            if (season.hasOwnProperty(episodeKey)) {
                                const episode = season[episodeKey];
                                arabicSeries.appendChild(createSeriesCard(episode, 'arSerious', seasonKey, episodeKey));
                                break; // Just show one episode per season
                            }
                        }
                    }
                }
            });
            
            // Load Anime Series
            database.ref('aniSerious').once('value').then(snapshot => {
                const series = snapshot.val();
                const animeSeries = document.getElementById('anime-series');
                animeSeries.innerHTML = '';
                
                for (const seasonKey in series) {
                    if (series.hasOwnProperty(seasonKey)) {
                        const season = series[seasonKey];
                        for (const episodeKey in season) {
                            if (season.hasOwnProperty(episodeKey)) {
                                const episode = season[episodeKey];
                                animeSeries.appendChild(createSeriesCard(episode, 'aniSerious', seasonKey, episodeKey));
                                break; // Just show one episode per season
                            }
                        }
                    }
                }
            });
            
            // Load Korean Series
            database.ref('krSerious').once('value').then(snapshot => {
                const series = snapshot.val();
                const koreanSeries = document.getElementById('korean-series');
                koreanSeries.innerHTML = '';
                
                for (const seasonKey in series) {
                    if (series.hasOwnProperty(seasonKey)) {
                        const season = series[seasonKey];
                        for (const episodeKey in season) {
                            if (season.hasOwnProperty(episodeKey)) {
                                const episode = season[episodeKey];
                                koreanSeries.appendChild(createSeriesCard(episode, 'krSerious', seasonKey, episodeKey));
                                break; // Just show one episode per season
                            }
                        }
                    }
                }
                
                hideLoading();
            }).catch(error => {
                console.error('Error loading content:', error);
                hideLoading();
            });
        }
        
        // Create movie card element
        function createMovieCard(movie, category, id, type) {
            const card = document.createElement('div');
            card.className = 'movie-card';
            
            card.innerHTML = `
                <img src="${movie.image}" alt="${movie.name}" class="movie-poster">
                <div class="movie-title-overlay">
                    <div class="movie-title-text">${movie.name}</div>
                </div>
            `;
            
            card.addEventListener('click', () => {
                showMovieDetail({
                    type: type,
                    category: category,
                    id: id,
                    name: movie.name,
                    desc: movie.desc,
                    image: movie.image,
                    url: movie.url,
                    qualityUrls: movie.qualityUrls || {},
                    rating: movie.rating || 0,
                    currentTime: 0
                });
            });
            
            return card;
        }
        
        // Create series card element
        function createSeriesCard(episode, category, seasonId, episodeId) {
            const card = document.createElement('div');
            card.className = 'movie-card';
            
            card.innerHTML = `
                <img src="${episode.image}" alt="${episode.name}" class="movie-poster">
                <div class="movie-title-overlay">
                    <div class="movie-title-text">${episode.name}</div>
                </div>
            `;
            
            card.addEventListener('click', () => {
                // First load all seasons for this series
                showLoading();
                database.ref(category).once('value').then(snapshot => {
                    const seasons = snapshot.val();
                    
                    currentMovie = {
                        type: 'series',
                        category: category,
                        id: episodeId,
                        name: episode.name.split(' - ')[0] || episode.name,
                        desc: episode.desc,
                        image: episode.image,
                        url: episode.url,
                        qualityUrls: episode.qualityUrls || {},
                        rating: episode.rating || 0,
                        seasons: seasons,
                        currentTime: 0
                    };
                    
                    showSeasonsPage();
                    hideLoading();
                }).catch(error => {
                    console.error('Error loading seasons:', error);
                    hideLoading();
                });
            });
            
            return card;
        }
        
        // Show movie details
        function showMovieDetail(movie) {
            currentMovie = movie;
            
            // Update movie detail page
            document.getElementById('detail-movie-title').textContent = movie.name;
            document.getElementById('detail-movie-description').textContent = movie.desc;
            document.getElementById('detail-movie-poster').src = movie.image;
            document.getElementById('detail-movie-rating').innerHTML = `
                <i class="fas fa-star"></i>
                <span>${movie.rating.toFixed(1)}</span>
            `;
            document.getElementById('movie-backdrop').style.backgroundImage = `url('${movie.image}')`;
            
            // Update favorite button
            const favoriteBtn = document.getElementById('favorite-btn');
            const movieKey = `${movie.type}_${movie.category}_${movie.id}`;
            if (favorites[movieKey]) {
                favoriteBtn.classList.add('active');
            } else {
                favoriteBtn.classList.remove('active');
            }
            
            showMovieDetailPage();
        }
        
        // Show seasons page for series
        function showSeasonsPage() {
            const seasonsContainer = document.getElementById('seasons-container');
            seasonsContainer.innerHTML = '';
            
            for (const seasonKey in currentMovie.seasons) {
                if (currentMovie.seasons.hasOwnProperty(seasonKey)) {
                    const season = currentMovie.seasons[seasonKey];
                    const seasonDiv = document.createElement('div');
                    seasonDiv.className = 'season-card';
                    
                    // Get season name from first episode
                    let seasonName = 'الموسم الأول';
                    for (const epKey in season) {
                        if (season.hasOwnProperty(epKey)) {
                            const ep = season[epKey];
                            if (ep.epNumber && ep.epNumber.includes('الموسم')) {
                                seasonName = ep.epNumber.split(' - ')[1] || seasonName;
                            }
                            break;
                        }
                    }
                    
                    seasonDiv.innerHTML = `
                        <h3 class="season-title">${seasonName}</h3>
                        <div class="episodes-container" id="season-${seasonKey}"></div>
                    `;
                    
                    seasonsContainer.appendChild(seasonDiv);
                    
                    // Add episodes
                    const episodesContainer = document.getElementById(`season-${seasonKey}`);
                    for (const epKey in season) {
                        if (season.hasOwnProperty(epKey)) {
                            const episode = season[epKey];
                            const episodeCard = document.createElement('div');
                            episodeCard.className = 'episode-card';
                            
                            episodeCard.innerHTML = `
                                <img src="${episode.image}" alt="${episode.name}" class="episode-image">
                                <div class="episode-info">
                                    <div class="episode-number">${episode.epNumber || 'الحلقة 1'}</div>
                                    <div class="episode-name">${episode.name}</div>
                                </div>
                            `;
                            
                            episodeCard.addEventListener('click', () => {
                                showVideoPlayer(episode.url, episode.name, episode.qualityUrls);
                            });
                            
                            episodesContainer.appendChild(episodeCard);
                        }
                    }
                }
            }
            
            mainPage.style.display = 'none';
            movieDetailPage.style.display = 'none';
            seasonsPage.style.display = 'block';
            videoPlayerPage.style.display = 'none';
            searchPage.style.display = 'none';
            favoritesPage.style.display = 'none';
            
            // Add to history for back button
            history.pushState({ page: 'seasons' }, null, null);
        }
        
        // Handle video click (play/pause or show controls)
        function handleVideoClick(e) {
            const now = Date.now();
            
            if (now - lastTapTime < 300) {
                // Double tap - skip forward/backward
                const rect = e.target.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                
                if (pos < 0.3) {
                    skipBackward();
                } else if (pos > 0.7) {
                    skipForward();
                } else {
                    togglePlayPause();
                }
            } else {
                // Single tap - toggle play/pause
                togglePlayPause();
            }
            
            lastTapTime = now;
            resetControlsTimer();
        }
        
        // Reset controls hide timer
        function resetControlsTimer() {
            clearTimeout(controlsTimeout);
            
            // Show controls
            document.querySelector('.top-controls').classList.add('active');
            document.querySelector('.bottom-controls').classList.add('active');
            
            // Hide after 2 seconds
            controlsTimeout = setTimeout(() => {
                document.querySelector('.top-controls').classList.remove('active');
                document.querySelector('.bottom-controls').classList.remove('active');
            }, 2000);
        }
        
        // Toggle play/pause
        function togglePlayPause() {
            if (videoPlayer.paused) {
                videoPlayer.play();
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                centerPlayIcon.className = 'fas fa-pause';
                centerPlayBtn.classList.remove('show');
            } else {
                videoPlayer.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                centerPlayIcon.className = 'fas fa-play';
                centerPlayBtn.classList.add('show');
            }
            
            resetControlsTimer();
        }
        
        // Toggle mute
        function toggleMute() {
            isMuted = !isMuted;
            videoPlayer.muted = isMuted;
            muteBtn.innerHTML = isMuted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
            resetControlsTimer();
        }
        
        // Skip backward 10 seconds
        function skipBackward() {
            videoPlayer.currentTime = Math.max(0, videoPlayer.currentTime - 10);
            resetControlsTimer();
        }
        
        // Skip forward 10 seconds
        function skipForward() {
            videoPlayer.currentTime = Math.min(videoPlayer.duration, videoPlayer.currentTime + 10);
            resetControlsTimer();
        }
        
        // Update time display
        function updateTimeDisplay() {
            const currentTime = formatTime(videoPlayer.currentTime);
            const totalTime = formatTime(videoPlayer.duration);
            
            document.getElementById('current-time').textContent = currentTime;
            document.getElementById('total-time').textContent = totalTime;
            
            const progressPercent = (videoPlayer.currentTime / videoPlayer.duration) * 100;
            progressBar.style.width = `${progressPercent}%`;
        }
        
        // Format time (seconds to MM:SS)
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Change playback speed
        function changeSpeed(speed) {
            videoPlayer.playbackRate = speed;
            currentSpeed = speed;
            
            // Update active button in speed menu
            const options = speedMenu.querySelectorAll('.settings-option');
            options.forEach(option => {
                option.classList.remove('active');
                if (option.textContent.includes(`${speed}x`) || (speed === 1 && option.textContent.includes('1x'))) {
                    option.classList.add('active');
                }
            });
            
            hideSpeedMenu();
            resetControlsTimer();
        }
        
        // Change video quality
        function changeQuality(quality) {
            currentQuality = quality;
            
            // If quality is auto, use the default URL
            if (quality === 'auto') {
                videoPlayer.src = currentMovie.url;
            } else if (currentMovie.qualityUrls && currentMovie.qualityUrls[quality]) {
                // If specific quality is available, use it
                videoPlayer.src = currentMovie.qualityUrls[quality];
            }
            
            // Save current time and play from there
            const currentTime = videoPlayer.currentTime;
            videoPlayer.currentTime = currentTime;
            
            // Update active button in quality menu
            const options = qualityMenu.querySelectorAll('.settings-option');
            options.forEach(option => {
                option.classList.remove('active');
                if (option.textContent.includes(quality) || (quality === 'auto' && option.textContent.includes('تلقائي'))) {
                    option.classList.add('active');
                }
            });
            
            hideQualityMenu();
            resetControlsTimer();
        }
        
        // Show quality menu
        function showQualityMenu() {
            hideAllMenus();
            qualityMenu.classList.add('show');
        }
        
        // Hide quality menu
        function hideQualityMenu() {
            qualityMenu.classList.remove('show');
        }
        
        // Show speed menu
        function showSpeedMenu() {
            hideAllMenus();
            speedMenu.classList.add('show');
        }
        
        // Hide speed menu
        function hideSpeedMenu() {
            speedMenu.classList.remove('show');
        }
        
        // Hide all menus
        function hideAllMenus() {
            settingsMenu.classList.remove('show');
            qualityMenu.classList.remove('show');
            speedMenu.classList.remove('show');
        }
        
        // Toggle fullscreen
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
            
            resetControlsTimer();
        }
        
        // Toggle favorite
        function toggleFavorite() {
            const favoriteBtn = document.getElementById('favorite-btn');
            const movieKey = `${currentMovie.type}_${currentMovie.category}_${currentMovie.id}`;
            
            if (favorites[movieKey]) {
                delete favorites[movieKey];
                favoriteBtn.classList.remove('active');
            } else {
                favorites[movieKey] = currentMovie;
                favoriteBtn.classList.add('active');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            loadFavorites();
        }
        
        // Load favorites
        function loadFavorites() {
            const favoritesGrid = document.getElementById('favorites-grid');
            favoritesGrid.innerHTML = '';
            
            if (Object.keys(favorites).length === 0) {
                favoritesGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; color: var(--gray-color); padding: 40px 0;">
                        <i class="fas fa-heart" style="font-size: 40px; margin-bottom: 15px;"></i>
                        <p>لا توجد أفلام في قائمة المفضلة</p>
                    </div>
                `;
                return;
            }
            
            for (const key in favorites) {
                const movie = favorites[key];
                const card = document.createElement('div');
                card.className = 'movie-card';
                
                card.innerHTML = `
                    <img src="${movie.image}" alt="${movie.name}" class="movie-poster">
                    <div class="movie-title-overlay">
                        <div class="movie-title-text">${movie.name}</div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    if (movie.type === 'series') {
                        currentMovie = movie;
                        showSeasonsPage();
                    } else {
                        showMovieDetail(movie);
                    }
                });
                
                favoritesGrid.appendChild(card);
            }
        }
        
        // Show main page
        function showMainPage() {
            // Pause video if playing
            if (videoPlayer && !videoPlayer.paused) {
                videoPlayer.pause();
            }
            
            mainPage.style.display = 'block';
            movieDetailPage.style.display = 'none';
            seasonsPage.style.display = 'none';
            videoPlayerPage.style.display = 'none';
            searchPage.style.display = 'none';
            favoritesPage.style.display = 'none';
            
            document.querySelectorAll('.bottom-nav .nav-button').forEach((btn, index) => {
                if (index === 0) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Add to history for back button
            history.pushState({ page: 'main' }, null, null);
        }
        
        // Show movie detail page
        function showMovieDetailPage() {
            // Pause video if playing
            if (videoPlayer && !videoPlayer.paused) {
                videoPlayer.pause();
            }
            
            mainPage.style.display = 'none';
            movieDetailPage.style.display = 'block';
            seasonsPage.style.display = 'none';
            videoPlayerPage.style.display = 'none';
            searchPage.style.display = 'none';
            favoritesPage.style.display = 'none';
            
            // Add to history for back button
            history.pushState({ page: 'detail' }, null, null);
        }
        
        // Show video player
        function showVideoPlayer(videoUrl, videoTitle, qualityUrls = {}) {
            showLoading();
            
            mainPage.style.display = 'none';
            movieDetailPage.style.display = 'none';
            seasonsPage.style.display = 'none';
            videoPlayerPage.style.display = 'block';
            searchPage.style.display = 'none';
            favoritesPage.style.display = 'none';
            
            // Update current movie with quality URLs if available
            if (qualityUrls && Object.keys(qualityUrls).length > 0) {
                currentMovie.qualityUrls = qualityUrls;
            }
            
            // Set video source based on current quality
            if (currentQuality === 'auto' || !currentMovie.qualityUrls[currentQuality]) {
                videoPlayer.src = videoUrl || currentMovie.url;
            } else {
                videoPlayer.src = currentMovie.qualityUrls[currentQuality];
            }
            
            document.getElementById('player-movie-title').textContent = videoTitle || currentMovie.name;
            
            // Reset player state
            isMuted = false;
            videoPlayer.muted = false;
            muteBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
            
            // Start from saved time if available
            if (currentMovie.currentTime > 0) {
                videoPlayer.currentTime = currentMovie.currentTime;
            }
            
            // Start paused
            videoPlayer.pause();
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            centerPlayIcon.className = 'fas fa-play';
            centerPlayBtn.classList.add('show');
            isPlaying = false;
            
            videoPlayer.oncanplay = () => {
                hideLoading();
                // Show controls initially
                document.querySelector('.top-controls').classList.add('active');
                document.querySelector('.bottom-controls').classList.add('active');
                resetControlsTimer();
            };
            
            videoPlayer.onerror = () => {
                hideLoading();
                alert('حدث خطأ أثناء تحميل الفيديو. يرجى المحاولة لاحقًا.');
                if (currentMovie.type === 'series') {
                    showSeasonsPage();
                } else {
                    showMovieDetailPage();
                }
            };
            
            // Add to history for back button
            history.pushState({ page: 'player' }, null, null);
        }
        
        // Back from player
        function backFromPlayer() {
            // Save current time before leaving
            currentMovie.currentTime = videoPlayer.currentTime;
            
            // Pause video
            videoPlayer.pause();
            
            if (currentMovie.type === 'series') {
                showSeasonsPage();
            } else {
                showMovieDetailPage();
            }
        }
        
        // Show search page
        function showSearchPage() {
            mainPage.style.display = 'none';
            movieDetailPage.style.display = 'none';
            seasonsPage.style.display = 'none';
            videoPlayerPage.style.display = 'none';
            searchPage.style.display = 'flex';
            favoritesPage.style.display = 'none';
            
            searchInput.value = '';
            searchInput.focus();
            document.getElementById('search-placeholder').style.display = 'block';
            document.getElementById('search-results').innerHTML = '';
            
            document.querySelectorAll('.bottom-nav .nav-button').forEach((btn, index) => {
                if (index === 1) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Add to history for back button
            history.pushState({ page: 'search' }, null, null);
        }
        
        // Hide search page
        function hideSearchPage() {
            showMainPage();
        }
        
        // Show favorites page
        function showFavoritesPage() {
            mainPage.style.display = 'none';
            movieDetailPage.style.display = 'none';
            seasonsPage.style.display = 'none';
            videoPlayerPage.style.display = 'none';
            searchPage.style.display = 'none';
            favoritesPage.style.display = 'flex';
            
            document.querySelectorAll('.bottom-nav .nav-button').forEach((btn, index) => {
                if (index === 2) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Add to history for back button
            history.pushState({ page: 'favorites' }, null, null);
        }
        
        // Initialize search functionality
        function initSearch() {
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performSearch(this.value.trim());
                }, 300);
            });
        }
        
        // Perform search (case insensitive)
        function performSearch(query) {
            const placeholder = document.getElementById('search-placeholder');
            const searchResults = document.getElementById('search-results');
            
            if (query.length < 2) {
                placeholder.style.display = 'block';
                searchResults.innerHTML = '';
                return;
            }
            
            placeholder.style.display = 'none';
            searchResults.innerHTML = '<div class="loading-spinner"><div class="spinner"></div></div>';
            
            // Search all categories
            const allContent = [];
            const categories = ['ar', 'en', 'ani', 'kr', 'arSerious', 'aniSerious', 'krSerious'];
            
            const searchPromises = categories.map(category => {
                return database.ref(category).once('value').then(snapshot => {
                    const items = snapshot.val();
                    
                    if (category.includes('Serious')) {
                        // This is a series
                        for (const seasonKey in items) {
                            if (items.hasOwnProperty(seasonKey)) {
                                const season = items[seasonKey];
                                for (const episodeKey in season) {
                                    if (season.hasOwnProperty(episodeKey)) {
                                        const episode = season[episodeKey];
                                        allContent.push({
                                            ...episode,
                                            type: 'series',
                                            category: category,
                                            seasonId: seasonKey,
                                            id: episodeKey
                                        });
                                        break; // Just index first episode of each season
                                    }
                                }
                            }
                        }
                    } else {
                        // This is a movie
                        for (const key in items) {
                            if (items.hasOwnProperty(key)) {
                                const item = items[key];
                                allContent.push({
                                    ...item,
                                    type: 'movie',
                                    category: category,
                                    id: key
                                });
                            }
                        }
                    }
                });
            });
            
            Promise.all(searchPromises).then(() => {
                // Filter results (case insensitive)
                const queryLower = query.toLowerCase();
                const results = allContent.filter(item => 
                    item.name && item.name.toLowerCase().includes(queryLower) || 
                    (item.desc && item.desc.toLowerCase().includes(queryLower))
                );
                
                // Display results
                searchResults.innerHTML = '';
                
                if (results.length === 0) {
                    searchResults.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-search" style="font-size: 40px; margin-bottom: 15px;"></i>
                            <p>لا توجد نتائج للبحث "${query}"</p>
                        </div>
                    `;
                } else {
                    results.forEach(item => {
                        const card = document.createElement('div');
                        card.className = 'movie-card';
                        
                        card.innerHTML = `
                            <img src="${item.image}" alt="${item.name}" class="movie-poster">
                            <div class="movie-title-overlay">
                                <div class="movie-title-text">${item.name}</div>
                            </div>
                        `;
                        
                        card.addEventListener('click', () => {
                            if (item.type === 'series') {
                                // First load all seasons for this series
                                showLoading();
                                database.ref(item.category).once('value').then(snapshot => {
                                    const seasons = snapshot.val();
                                    
                                    currentMovie = {
                                        type: 'series',
                                        category: item.category,
                                        id: item.id,
                                        name: item.name.split(' - ')[0] || item.name,
                                        desc: item.desc,
                                        image: item.image,
                                        url: item.url,
                                        qualityUrls: item.qualityUrls || {},
                                        rating: item.rating || 0,
                                        seasons: seasons,
                                        currentTime: 0
                                    };
                                    
                                    showSeasonsPage();
                                    hideLoading();
                                }).catch(error => {
                                    console.error('Error loading seasons:', error);
                                    hideLoading();
                                });
                            } else {
                                showMovieDetail({
                                    ...item,
                                    currentTime: 0
                                });
                            }
                        });
                        
                        searchResults.appendChild(card);
                    });
                }
            }).catch(error => {
                console.error('Search error:', error);
                searchResults.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-exclamation-triangle" style="font-size: 40px; margin-bottom: 15px;"></i>
                        <p>حدث خطأ أثناء البحث. يرجى المحاولة لاحقًا.</p>
                    </div>
                `;
            });
        }
        
        // Setup glow effect for movie cards
        function setupGlowEffect() {
            const cards = document.querySelectorAll('.movie-card');
            
            // Apply glow effect to random cards every 10 seconds
            setInterval(() => {
                cards.forEach(card => card.classList.remove('glow'));
                
                // Select 1-3 random cards to glow
                const glowCount = Math.floor(Math.random() * 3) + 1;
                for (let i = 0; i < glowCount; i++) {
                    const randomIndex = Math.floor(Math.random() * cards.length);
                    cards[randomIndex].classList.add('glow');
                    
                    // Remove glow after 3 seconds
                    setTimeout(() => {
                        cards[randomIndex].classList.remove('glow');
                    }, 3000);
                }
            }, 10000);
        }
        
        // Show loading spinner
        function showLoading() {
            loadingSpinner.style.display = 'block';
        }
        
        // Hide loading spinner
        function hideLoading() {
            loadingSpinner.style.display = 'none';
        }
        
        // Initialize favorite button
        document.getElementById('favorite-btn').addEventListener('click', toggleFavorite);
    </script>
</body>
</html>
